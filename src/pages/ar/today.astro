---
import { HexGrid } from "@/components/ramadan/HexGrid";
import { SideDrawer } from "@/components/ramadan/SideDrawer";
import LoadingSkeleton from "@/components/ui/LoadingSkeleton.astro";
import type { Locale } from "@/i18n/utils";
import { useTranslations } from "@/i18n/utils";
import BaseLayout from "@/layouts/BaseLayout.astro";

const locale: Locale = "ar";
const t = useTranslations(locale);
---

<BaseLayout
  title={t("today.title")}
  description={t("site.description")}
  noindex
>
  {/* SSR skeleton — visible instantly, hidden once React hydrates */}
  <div id="ssr-skeleton">
    <LoadingSkeleton variant="hexgrid" locale={locale} />
  </div>
  <div id="react-root" style="display:none">
    <HexGrid client:load locale={locale} />
  </div>
  <SideDrawer client:idle locale={locale} currentPath={Astro.url.pathname} />
  <script is:inline>
    // Swap skeleton → React once island hydrates
    const observer = new MutationObserver(() => {
      const root = document.getElementById("react-root");
      if (root && root.querySelector("[data-hydrated]")) {
        document.getElementById("ssr-skeleton")?.remove();
        root.style.display = "";
        observer.disconnect();
      }
    });
    const root = document.getElementById("react-root");
    if (root)
      observer.observe(root, {
        childList: true,
        subtree: true,
        attributes: true,
      });
    // Fallback: show after 3s regardless
    setTimeout(() => {
      document.getElementById("ssr-skeleton")?.remove();
      const r = document.getElementById("react-root");
      if (r) r.style.display = "";
    }, 3000);
  </script>
</BaseLayout>
